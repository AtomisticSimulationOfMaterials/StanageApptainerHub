# INSTRUCTIONS
# 1. Build the image:
#    apptainer build base.sif base.def
#
# 2. Build the image with full debug log (for troubleshooting):
#    apptainer build --disable-cache base.sif base.def > build_base.log
#
# 3. Run the image interactively (shell into it):
#    apptainer shell base.sif

Bootstrap: docker
From: ubuntu:24.04

%labels
    Author Ethan L. Edmunds
    Version v1.0
    Description Base image for apptainer files on HPC

%post
    export DEBIAN_FRONTEND=noninteractive
    apt-get update && apt-get install -y \
        build-essential \
        wget \
        cmake \
        git \
        mpich \
        libfftw3-dev \
        python3 \
        python3-pip \
        python3-venv \
        wget \
        && rm -rf /var/lib/apt/lists/*

    # Create Python virtual environment
    python3 -m venv /opt/venv

    # Activate venv for package installation
    . /opt/venv/bin/activate

    pip install --upgrade pip
    pip install numpy

%environment
    # Make venv the default Python for all container sessions
    export PATH=/opt/venv/bin:$PATH
    export LD_LIBRARY_PATH=/usr/local/lib:$LD_LIBRARY_PATH
